<!doctype HTML>
<html>
<head>
<meta charset="UTF-8">
<title>Golang essentials.</title>
<script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>
<script>
  class MyTextSVG { 
    constructor(font, size) {
      this.font = font;
      this.size = size;
      this.lineHeight = size;
      [this.x, this.y] = [0, this.lineHeight];
      this.svg = `<svg width="20cm" height="10cm" xmlns="http://www.w3.org/2000/svg">\n`;
      //this.svg += `<rect width="100%" height="100%" fill="green"/>`
    }    
    write(text, color) {
      let d = this.font.getPath(text, this.x, this.y, this.size).toPathData(3);
      this.svg += `<path fill="${color}" d="${d}" />\n`;
      this.x += this.font.getAdvanceWidth(text, this.size);
    }
    newLine() {
      this.x = 0;
      this.y += this.lineHeight;
    }    
    getSVG() {
      return this.svg + `</svg>`;
    }
  };

  opentype.load('//nabla.ujkl.ru/fonts/ubuntu-mono-v8-latin-regular.woff', function(err, font) {
    if (err) {
      console.log('Font could not be loaded: ' + err);
      return;
    }

    const kStmt = 'rgb(255,32,112)';
    const kLitr = 'rgb(176,128,255)';
    
    let svg = new MyTextSVG(font, 100);
    svg.write('if', kStmt);
    svg.write(' err != ', 'white');
    svg.write('nil', kLitr);
    svg.write(' {', 'white');
    svg.newLine();
    svg.write('    return', kStmt);
    svg.write(' err', 'white');
    svg.newLine();
    svg.write('}', 'white');
    let svgText = svg.getSVG();

    document.getElementById('svg').innerHTML = svgText;
    document.querySelector('pre').innerText = svgText;

    let img = new Image();
    img.src = 'data:image/svg+xml;base64,' + btoa(svgText);
    let ctx = document.querySelector('canvas').getContext('2d');
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
    ctx.drawImage(img, 0, 0, ctx.canvas.width, ctx.canvas.height);
  })
</script>
</head>
<body>
  <div id="svg" style="background: black;"></div>
  <hr/>
  <pre></pre>
  <hr/>
  <canvas width="400" height="200"></canvas>
  <hr/>
  Powered by <a href="https://github.com/opentypejs/opentype.js" target="_blank" rel="noopener noreferrer">opentype.js</a>.
</body>
</html>

