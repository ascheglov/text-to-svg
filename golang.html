<!doctype HTML>
<html>
<head>
<meta charset="UTF-8">
<title>Golang essentials.</title>
<script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>
<script>
  class MyTextSVG { 
    constructor(font, size) {
      this.font = font;
      this.size = size;
      this.lineHeight = size;
      [this.x, this.y] = [0, this.lineHeight];
      this.svg = `<svg width="20cm" height="10cm" xmlns="http://www.w3.org/2000/svg">\n`;
      //this.svg += `<rect width="100%" height="100%" fill="green"/>`
    }    
    write(text, color) {
      let d = this.font.getPath(text, this.x, this.y, this.size).toPathData(3);
      this.svg += `\t<path fill="${color}" d="${d}" />\n`;
      this.x += this.font.getAdvanceWidth(text, this.size);
    }
    newLine() {
      this.x = 0;
      this.y += this.lineHeight;
    }    
    getSVG() {
      return this.svg + `</svg>`;
    }
  }

  function redraw(font) {
    const kStmt = document.getElementById('stmt-color').value;
    const kLitr = document.getElementById('litr-color').value;
    
    let svg = new MyTextSVG(font, 100);
    svg.write('if', kStmt);
    svg.write(' err != ', 'white');
    svg.write('nil', kLitr);
    svg.write(' {', 'white');
    svg.newLine();
    svg.write('    return', kStmt);
    svg.write(' err', 'white');
    svg.newLine();
    svg.write('}', 'white');
    let svgText = svg.getSVG();

    document.getElementById('svg').innerHTML = svgText;
    document.querySelector('pre').innerText = svgText;

    let svgData = 'data:image/svg+xml;base64,' + btoa(svgText);
    document.getElementById('download').href = svgData;

    let ctx = document.querySelector('canvas').getContext('2d');
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);

    let img = new Image();
    img.onload = function() {
      ctx.drawImage(img, 0, 0, ctx.canvas.width, ctx.canvas.height);
    }
    img.src = svgData;
  }

  var g_font;
  opentype.load('//nabla.ujkl.ru/fonts/ubuntu-mono-v8-latin-regular.woff', function(err, font) {
    if (err) {
      console.log('Font could not be loaded: ' + err);
    } else {
      g_font = font;
      redraw(font);
    }
  })
</script>
</head>
<body>
  <div id="svg" style="background: black;"></div>
  <svg viewBox="0 0 24 2" width="24cm" height="2cm" xmlns="http://www.w3.org/2000/svg">
    <path fill="blue" d="M0,1v1h1v-2h1v2h1v-2h1v2h1v-2h1v2h1v-2h1v2h1v-2h1v1z"/>
    <path fill="red" d="M10,1v1h1v-2h1v2h1v-2h1v2h1v-2h1v2h1v-2h1v2h1v-2h1v1z"/>
    <path fill="blue" d="M20,1v1h1v-2h1v2h1v-2h1v1z"/>
  </svg>
  <p>
    Statement color: <input id="stmt-color" value="rgb(255,32,112)" />
    literal color: <input id="litr-color" value="rgb(176,128,255)" />
    <button onclick="redraw(g_font)">Draw!</button>
  </p>
  <hr/>
  SVG: (<a href="#" id="download" download="golang.svg">Download file</a>)
  <pre></pre>
  PNG:<br/>
  <canvas width="400" height="200"></canvas>
  <hr/>
  Powered by <a href="https://github.com/opentypejs/opentype.js" target="_blank" rel="noopener noreferrer">opentype.js</a>.
</body>
</html>

